<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <meta name="description" content="strconv - æˆ‘æ˜¯ä¸€ä¸ªGolangæ¨¡å—">
    <meta name="keywords" content="golang,go">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ç”¨Golangå†™çˆ¬è™«(äºŒ) - å¹¶å‘"/>
<meta name="twitter:description" content="åœ¨ä¸Šç¯‡æ–‡ç« é‡Œé¢æˆ‘ç”¨Goå†™äº†ä¸€ä¸ªçˆ¬è™«ï¼Œä½†æ˜¯å®ƒçš„æ‰§è¡Œæ˜¯ä¸²è¡Œçš„ï¼Œæ•ˆç‡å¾ˆä½ï¼Œè¿™ç¯‡æ–‡ç« æŠŠå®ƒæ”¹æˆå¹¶å‘çš„ã€‚ç”±äºè¿™ä¸ªç¨‹åºåªæŠ“å–10ä¸ªé¡µé¢ï¼Œå¤§æ¦‚1så¤šå°±å®Œæˆäº†ï¼Œä¸ºäº†å¯¹æ¯”æˆ‘ä»¬å…ˆç»™ä¹‹å‰çš„doubanCrawler1.goåŠ ä¸€ç‚¹Sleepçš„ä»£ç ï¼Œè®©å®ƒè·‘çš„ã€Œæ…¢ã€äº›ï¼š
func parseUrls(url string) { ... time.Sleep(2 * time.Second) } è¿™æ ·è¿è¡Œèµ·æ¥å¤§ä½“å¯ä»¥è®¡ç®—å‡ºæ¥ç¨‹åºè·‘å®Œçº¦éœ€è¦21s&#43;ï¼Œæˆ‘ä»¬è¿è¡Œä¸€ä¸‹è¯•è¯•ï¼š
â¯ go run doubanCrawler2.go ... Took 21.315744555s å·²ç»å¾ˆæ…¢äº†ã€‚æ¥ç€æˆ‘ä»¬å¼€å§‹è®©å®ƒå˜å¾—æ›´å¿«~
goroutineçš„é”™è¯¯ç”¨æ³• å…ˆä¿®æ”¹æˆç”¨GoåŸç”Ÿæ”¯æŒçš„å¹¶å‘æ–¹æ¡ˆgoroutineæ¥åšã€‚åœ¨Golangä¸­ä½¿ç”¨goroutineéå¸¸æ–¹ä¾¿ï¼Œç›´æ¥ä½¿ç”¨Goå…³é”®å­—å°±å¯ä»¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªç‰ˆæœ¬ï¼š
func main() { start := time.Now() for i := 0; i &lt; 10; i&#43;&#43; { go parseUrls(&#34;https://movie.douban.com/top250?start=&#34; &#43; strconv.Itoa(25*i)) } elapsed := time.Since(start) fmt.Printf(&#34;Took %s&#34;, elapsed) } å°±æ˜¯åœ¨parseUrlså‡½æ•°å‰åŠ äº†goå…³é”®å­—ã€‚ä½†å…¶å®è¿™æ ·å°±æ˜¯ä¸å¯¹çš„ï¼Œè¿è¡Œçš„è¯ä¸ä¼šæŠ“å–åˆ°ä»»ä½•ç»“æœã€‚å› ä¸ºåç¨‹åˆšç”Ÿæˆï¼Œæ•´ä¸ªç¨‹åºå°±ç»“æŸäº†ï¼Œgoroutineè¿˜æ²¡æŠ“å®Œå‘¢ã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿå¯ä»¥ç»“æŸå‰Sleepä¸€ä¸ªæ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´åº”è¯¥è¦å¤§äºæ‰€æœ‰goroutineæ‰§è¡Œæœ€æ…¢çš„é‚£ä¸ªï¼Œè¿™æ ·å°±ä¿è¯äº†å…¨éƒ¨åç¨‹éƒ½èƒ½æ­£å¸¸è¿è¡Œå®Œå†ç»“æŸ(doubanCrawler3.go)ï¼š
func main() { start := time.Now() for i := 0; i &lt; 10; i&#43;&#43; { go parseUrls(&#34;https://movie.douban.com/top250?start=&#34; &#43; strconv.Itoa(25*i)) } time."/>

    <meta property="og:title" content="ç”¨Golangå†™çˆ¬è™«(äºŒ) - å¹¶å‘" />
<meta property="og:description" content="åœ¨ä¸Šç¯‡æ–‡ç« é‡Œé¢æˆ‘ç”¨Goå†™äº†ä¸€ä¸ªçˆ¬è™«ï¼Œä½†æ˜¯å®ƒçš„æ‰§è¡Œæ˜¯ä¸²è¡Œçš„ï¼Œæ•ˆç‡å¾ˆä½ï¼Œè¿™ç¯‡æ–‡ç« æŠŠå®ƒæ”¹æˆå¹¶å‘çš„ã€‚ç”±äºè¿™ä¸ªç¨‹åºåªæŠ“å–10ä¸ªé¡µé¢ï¼Œå¤§æ¦‚1så¤šå°±å®Œæˆäº†ï¼Œä¸ºäº†å¯¹æ¯”æˆ‘ä»¬å…ˆç»™ä¹‹å‰çš„doubanCrawler1.goåŠ ä¸€ç‚¹Sleepçš„ä»£ç ï¼Œè®©å®ƒè·‘çš„ã€Œæ…¢ã€äº›ï¼š
func parseUrls(url string) { ... time.Sleep(2 * time.Second) } è¿™æ ·è¿è¡Œèµ·æ¥å¤§ä½“å¯ä»¥è®¡ç®—å‡ºæ¥ç¨‹åºè·‘å®Œçº¦éœ€è¦21s&#43;ï¼Œæˆ‘ä»¬è¿è¡Œä¸€ä¸‹è¯•è¯•ï¼š
â¯ go run doubanCrawler2.go ... Took 21.315744555s å·²ç»å¾ˆæ…¢äº†ã€‚æ¥ç€æˆ‘ä»¬å¼€å§‹è®©å®ƒå˜å¾—æ›´å¿«~
goroutineçš„é”™è¯¯ç”¨æ³• å…ˆä¿®æ”¹æˆç”¨GoåŸç”Ÿæ”¯æŒçš„å¹¶å‘æ–¹æ¡ˆgoroutineæ¥åšã€‚åœ¨Golangä¸­ä½¿ç”¨goroutineéå¸¸æ–¹ä¾¿ï¼Œç›´æ¥ä½¿ç”¨Goå…³é”®å­—å°±å¯ä»¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªç‰ˆæœ¬ï¼š
func main() { start := time.Now() for i := 0; i &lt; 10; i&#43;&#43; { go parseUrls(&#34;https://movie.douban.com/top250?start=&#34; &#43; strconv.Itoa(25*i)) } elapsed := time.Since(start) fmt.Printf(&#34;Took %s&#34;, elapsed) } å°±æ˜¯åœ¨parseUrlså‡½æ•°å‰åŠ äº†goå…³é”®å­—ã€‚ä½†å…¶å®è¿™æ ·å°±æ˜¯ä¸å¯¹çš„ï¼Œè¿è¡Œçš„è¯ä¸ä¼šæŠ“å–åˆ°ä»»ä½•ç»“æœã€‚å› ä¸ºåç¨‹åˆšç”Ÿæˆï¼Œæ•´ä¸ªç¨‹åºå°±ç»“æŸäº†ï¼Œgoroutineè¿˜æ²¡æŠ“å®Œå‘¢ã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿå¯ä»¥ç»“æŸå‰Sleepä¸€ä¸ªæ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´åº”è¯¥è¦å¤§äºæ‰€æœ‰goroutineæ‰§è¡Œæœ€æ…¢çš„é‚£ä¸ªï¼Œè¿™æ ·å°±ä¿è¯äº†å…¨éƒ¨åç¨‹éƒ½èƒ½æ­£å¸¸è¿è¡Œå®Œå†ç»“æŸ(doubanCrawler3.go)ï¼š
func main() { start := time.Now() for i := 0; i &lt; 10; i&#43;&#43; { go parseUrls(&#34;https://movie.douban.com/top250?start=&#34; &#43; strconv.Itoa(25*i)) } time." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://strconv.com/posts/web-crawler-exercise-2/" />
<meta property="article:published_time" content="2019-07-08T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2019-07-08T00:00:00&#43;00:00"/>


    
      <base href="https://strconv.com/posts/web-crawler-exercise-2/">
    
    <title>
  ç”¨Golangå†™çˆ¬è™«(äºŒ) - å¹¶å‘ Â· strconv
</title>

    
      <link rel="canonical" href="https://strconv.com/posts/web-crawler-exercise-2/">
    

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://strconv.com/css/normalize.css" integrity="" crossorigin="anonymous" media="screen" />
    
    
    <link rel="stylesheet" href="https://strconv.com/css/coder.css" media="screen">

    

    

    

    

    <link rel="icon" type="image/png" href="https://strconv.com/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://strconv.com/images/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.55.6" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://strconv.com">
      strconv
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://strconv.com/">Home</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://strconv.com/tags/">Tags</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://strconv.com/categories/">Categories</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://strconv.com/about/">About</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">ç”¨Golangå†™çˆ¬è™«(äºŒ) - å¹¶å‘</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2019-07-08T00:00:00Z'>
                July 8, 2019
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              2 minutes read
            </span>
          </div>
          <div class="categories">
  <i class="fas fa-folder"></i>
    <a href="https://strconv.com/categories/crawler/">crawler</a></div>

          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://strconv.com/tags/crawler/">crawler</a>
      <span class="separator">â€¢</span>
    <a href="https://strconv.com/tags/concurrency/">concurrency</a></div>

        </div>
      </header>

      <div>
        

<p>åœ¨ä¸Šç¯‡æ–‡ç« é‡Œé¢æˆ‘ç”¨Goå†™äº†ä¸€ä¸ªçˆ¬è™«ï¼Œä½†æ˜¯å®ƒçš„æ‰§è¡Œæ˜¯ä¸²è¡Œçš„ï¼Œæ•ˆç‡å¾ˆä½ï¼Œè¿™ç¯‡æ–‡ç« æŠŠå®ƒæ”¹æˆå¹¶å‘çš„ã€‚ç”±äºè¿™ä¸ªç¨‹åºåªæŠ“å–10ä¸ªé¡µé¢ï¼Œå¤§æ¦‚1så¤šå°±å®Œæˆäº†ï¼Œä¸ºäº†å¯¹æ¯”æˆ‘ä»¬å…ˆç»™ä¹‹å‰çš„<code>doubanCrawler1.go</code>åŠ ä¸€ç‚¹Sleepçš„ä»£ç ï¼Œè®©å®ƒè·‘çš„ã€Œæ…¢ã€äº›ï¼š</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">parseUrls</span>(url <span style="color:#8be9fd">string</span>) {
    <span style="color:#ff79c6">...</span>
	time.<span style="color:#50fa7b">Sleep</span>(<span style="color:#bd93f9">2</span> <span style="color:#ff79c6">*</span> time.Second)
}</code></pre></div>

<p>è¿™æ ·è¿è¡Œèµ·æ¥å¤§ä½“å¯ä»¥è®¡ç®—å‡ºæ¥ç¨‹åºè·‘å®Œçº¦éœ€è¦21s+ï¼Œæˆ‘ä»¬è¿è¡Œä¸€ä¸‹è¯•è¯•ï¼š</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">â¯ go run doubanCrawler2.go
...
Took <span style="color:#bd93f9">21</span>.315744555s</code></pre></div>

<p>å·²ç»å¾ˆæ…¢äº†ã€‚æ¥ç€æˆ‘ä»¬å¼€å§‹è®©å®ƒå˜å¾—æ›´å¿«~</p>

<h3 id="goroutineçš„é”™è¯¯ç”¨æ³•">goroutineçš„é”™è¯¯ç”¨æ³•</h3>

<p>å…ˆä¿®æ”¹æˆç”¨GoåŸç”Ÿæ”¯æŒçš„å¹¶å‘æ–¹æ¡ˆgoroutineæ¥åšã€‚åœ¨Golangä¸­ä½¿ç”¨goroutineéå¸¸æ–¹ä¾¿ï¼Œç›´æ¥ä½¿ç”¨Goå…³é”®å­—å°±å¯ä»¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªç‰ˆæœ¬ï¼š</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">main</span>() {
	start <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Now</span>()
	<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">:=</span> <span style="color:#bd93f9">0</span>; i &lt; <span style="color:#bd93f9">10</span>; i<span style="color:#ff79c6">++</span> {
		<span style="color:#ff79c6">go</span> <span style="color:#50fa7b">parseUrls</span>(<span style="color:#f1fa8c">&#34;https://movie.douban.com/top250?start=&#34;</span> <span style="color:#ff79c6">+</span> strconv.<span style="color:#50fa7b">Itoa</span>(<span style="color:#bd93f9">25</span><span style="color:#ff79c6">*</span>i))
	}
	elapsed <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Since</span>(start)
	fmt.<span style="color:#50fa7b">Printf</span>(<span style="color:#f1fa8c">&#34;Took %s&#34;</span>, elapsed)
}</code></pre></div>

<p>å°±æ˜¯åœ¨parseUrlså‡½æ•°å‰åŠ äº†goå…³é”®å­—ã€‚ä½†å…¶å®è¿™æ ·å°±æ˜¯ä¸å¯¹çš„ï¼Œè¿è¡Œçš„è¯ä¸ä¼šæŠ“å–åˆ°ä»»ä½•ç»“æœã€‚å› ä¸ºåç¨‹åˆšç”Ÿæˆï¼Œæ•´ä¸ªç¨‹åºå°±ç»“æŸäº†ï¼Œgoroutineè¿˜æ²¡æŠ“å®Œå‘¢ã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿå¯ä»¥ç»“æŸå‰Sleepä¸€ä¸ªæ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´åº”è¯¥è¦å¤§äºæ‰€æœ‰goroutineæ‰§è¡Œæœ€æ…¢çš„é‚£ä¸ªï¼Œè¿™æ ·å°±ä¿è¯äº†å…¨éƒ¨åç¨‹éƒ½èƒ½æ­£å¸¸è¿è¡Œå®Œå†ç»“æŸ(doubanCrawler3.go)ï¼š</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">main</span>() {
    start <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Now</span>()
    <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">:=</span> <span style="color:#bd93f9">0</span>; i &lt; <span style="color:#bd93f9">10</span>; i<span style="color:#ff79c6">++</span> {
        <span style="color:#ff79c6">go</span> <span style="color:#50fa7b">parseUrls</span>(<span style="color:#f1fa8c">&#34;https://movie.douban.com/top250?start=&#34;</span> <span style="color:#ff79c6">+</span> strconv.<span style="color:#50fa7b">Itoa</span>(<span style="color:#bd93f9">25</span><span style="color:#ff79c6">*</span>i))
    }
    time.<span style="color:#50fa7b">Sleep</span>(<span style="color:#bd93f9">4</span> <span style="color:#ff79c6">*</span> time.Second)
    elapsed <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Since</span>(start)
    fmt.<span style="color:#50fa7b">Printf</span>(<span style="color:#f1fa8c">&#34;Took %s&#34;</span>, elapsed)
}</code></pre></div>

<p>åœ¨forå¾ªç¯ååŠ äº†Sleep 4ç§’ã€‚è¿è¡Œä¸€ä¸‹ï¼š</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">â¯ go run doubanCrawler3.go
...
Took <span style="color:#bd93f9">4</span>.000849896s  <span style="color:#6272a4"># è¿™ä¸ªæ—¶é—´å¤§è‡´å°±æ˜¯4s</span></code></pre></div>

<p>å½“ç„¶è¿™ä¸ªSleepçš„æ—¶é—´ä¸å¥½æ§åˆ¶ï¼Œå‡è®¾æŸæ¬¡è¯·æ±‚èŠ±çš„æ—¶é—´è¶…äº†ï¼Œæ€»ä½“æ—¶é—´è¶…è¿‡4sç¨‹åºç»“æŸäº†ä½†è¿™ä¸ªåç¨‹å…¶å®è¿˜æ²¡è¿è¡Œç»“æŸï¼›è€Œå‡å¦‚å…¨éƒ¨goroutineéƒ½åœ¨3ç§’ï¼ˆ2ç§’å›ºå®šSleep+1ç§’ç¨‹åºè¿è¡Œï¼‰ç»“æŸï¼Œé‚£ä¹ˆå¤šSleepçš„ä¸€ç§’å°±æµªè´¹äº†ï¼</p>

<h3 id="goroutineçš„æ­£ç¡®ç”¨æ³•">goroutineçš„æ­£ç¡®ç”¨æ³•</h3>

<p>é‚£æ€ä¹ˆç”¨goroutineå‘¢ï¼Ÿæœ‰æ²¡æœ‰åƒPythonå¤šè¿›ç¨‹/çº¿ç¨‹çš„é‚£ç§ç­‰å¾…å­è¿›/çº¿ç¨‹æ‰§è¡Œå®Œçš„joinæ–¹æ³•å‘¢ï¼Ÿå½“ç„¶æ˜¯æœ‰çš„ï¼Œå¯ä»¥è®©Go åç¨‹ä¹‹é—´ä¿¡é“ï¼ˆchannelï¼‰è¿›è¡Œé€šä¿¡ï¼šä»ä¸€ç«¯å‘é€æ•°æ®ï¼Œå¦ä¸€ç«¯æ¥æ”¶æ•°æ®ï¼Œä¿¡é“éœ€è¦å‘é€å’Œæ¥æ”¶é…å¯¹ï¼Œå¦åˆ™ä¼šè¢«é˜»å¡ï¼š</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">parseUrls</span>(url <span style="color:#8be9fd">string</span>, ch <span style="color:#8be9fd;font-style:italic">chan</span> <span style="color:#8be9fd">bool</span>) {
    <span style="color:#ff79c6">...</span>
    ch <span style="color:#ff79c6">&lt;-</span> <span style="color:#ff79c6">true</span>
}

<span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">main</span>() {
    start <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Now</span>()
    ch <span style="color:#ff79c6">:=</span> <span style="color:#8be9fd;font-style:italic">make</span>(<span style="color:#8be9fd;font-style:italic">chan</span> <span style="color:#8be9fd">bool</span>)
    <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">:=</span> <span style="color:#bd93f9">0</span>; i &lt; <span style="color:#bd93f9">10</span>; i<span style="color:#ff79c6">++</span> {
        <span style="color:#ff79c6">go</span> <span style="color:#50fa7b">parseUrls</span>(<span style="color:#f1fa8c">&#34;https://movie.douban.com/top250?start=&#34;</span><span style="color:#ff79c6">+</span>strconv.<span style="color:#50fa7b">Itoa</span>(<span style="color:#bd93f9">25</span><span style="color:#ff79c6">*</span>i), ch)
    }

    <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">:=</span> <span style="color:#bd93f9">0</span>; i &lt; <span style="color:#bd93f9">10</span>; i<span style="color:#ff79c6">++</span> {
        <span style="color:#ff79c6">&lt;-</span>ch
    }

    elapsed <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Since</span>(start)
    fmt.<span style="color:#50fa7b">Printf</span>(<span style="color:#f1fa8c">&#34;Took %s&#34;</span>, elapsed)
}</code></pre></div>

<p>åœ¨ä¸Šé¢çš„æ”¹æ³•ä¸­ï¼ŒparseUrlséƒ½æ˜¯åœ¨goroutineä¸­æ‰§è¡Œï¼Œä½†æ˜¯æ³¨æ„å‡½æ•°ç­¾åæ”¹äº†ï¼Œå¤šæ¥æ”¶äº†ä¿¡é“å‚æ•°chã€‚å½“å‡½æ•°é€»è¾‘æ‰§è¡Œç»“æŸä¼šç»™ä¿¡é“chå‘é€ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</p>

<p>è€Œåœ¨mainå‡½æ•°ä¸­ï¼Œåœ¨ç”¨ä¸€ä¸ªforå¾ªç¯ï¼Œ&lt;- ch ä¼šç­‰å¾…æ¥æ”¶æ•°æ®ï¼ˆè¿™é‡Œåªæ˜¯æ¥æ”¶ï¼Œç›¸å½“äºç¡®è®¤ä»»åŠ¡å®Œæˆï¼‰ã€‚è¿™æ ·çš„æµç¨‹å°±å®ç°äº†ä¸€ä¸ªæ›´å¥½çš„å¹¶å‘æ–¹æ¡ˆï¼š</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">â¯ go run doubanCrawler4.go
...
Took <span style="color:#bd93f9">2</span>.450826901s  <span style="color:#6272a4"># è¿™ä¸ªæ—¶é—´æ¯”ä¹‹å‰çš„å†™æ­»äº†4sçš„é‚£ä¸ªä¼˜åŒ–å¤ªå¤šäº†ï¼</span></code></pre></div>

<h3 id="sync-waitgroup">sync.WaitGroup</h3>

<p>è¿˜æœ‰ä¸€ä¸ªå¥½çš„æ–¹æ¡ˆsync.WaitGroupã€‚æˆ‘ä»¬è¿™ä¸ªç¨‹åºåªæ˜¯æ‰“å°æŠ“åˆ°çš„å¯¹åº”å†…å®¹ï¼Œæ‰€ä»¥æ­£å¥½ç”¨WaitGroupï¼šç­‰å¾…ä¸€ç»„å¹¶å‘æ“ä½œå®Œæˆï¼š</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#ff79c6">import</span> (
	<span style="color:#ff79c6">...</span>
	<span style="color:#f1fa8c">&#34;sync&#34;</span>
)
<span style="color:#ff79c6">...</span>
<span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">main</span>() {
	start <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Now</span>()
	<span style="color:#8be9fd;font-style:italic">var</span> wg sync.WaitGroup
	wg.<span style="color:#50fa7b">Add</span>(<span style="color:#bd93f9">10</span>)

	<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">:=</span> <span style="color:#bd93f9">0</span>; i &lt; <span style="color:#bd93f9">10</span>; i<span style="color:#ff79c6">++</span> {
		<span style="color:#ff79c6">go</span> <span style="color:#8be9fd;font-style:italic">func</span>(i <span style="color:#8be9fd">int</span>) {
			<span style="color:#ff79c6">defer</span> wg.<span style="color:#50fa7b">Done</span>()
			<span style="color:#50fa7b">parseUrls</span>(<span style="color:#f1fa8c">&#34;https://movie.douban.com/top250?start=&#34;</span><span style="color:#ff79c6">+</span>strconv.<span style="color:#50fa7b">Itoa</span>(<span style="color:#bd93f9">25</span><span style="color:#ff79c6">*</span>i))
		}(i)
	}

	wg.<span style="color:#50fa7b">Wait</span>()

	elapsed <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">Since</span>(start)
	fmt.<span style="color:#50fa7b">Printf</span>(<span style="color:#f1fa8c">&#34;Took %s&#34;</span>, elapsed)
}</code></pre></div>

<p>ä¸€å¼€å§‹æˆ‘ä»¬ç»™è°ƒç”¨wg.Addæ·»åŠ è¦ç­‰å¾…çš„goroutineé‡ï¼Œæˆ‘ä»¬çš„é¡µé¢æ€»æ•°å°±æ˜¯10ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ç›´æ¥å†™å‡ºæ¥ã€‚</p>

<p>å¦å¤–è¿™é‡Œä½¿ç”¨äº†deferå…³é”®å­—æ¥è°ƒç”¨wg.Doneï¼Œä»¥ç¡®ä¿åœ¨é€€å‡ºgoroutineçš„é—­åŒ…ä¹‹å‰ï¼Œå‘WaitGroupè¡¨æ˜äº†æˆ‘ä»¬å·²ç»é€€å‡ºã€‚ç”±äºè¦æ‰§è¡Œwg.Doneå’ŒparseUrls2ä»¶äº‹ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥ç”¨goå…³é”®å­—ï¼Œéœ€è¦æŠŠè¯­å¥åŒ…ä¸€ä¸‹ã€‚ä¸è¿‡è¦æ³¨æ„ï¼Œåœ¨é—­åŒ…ä¸­éœ€è¦æŠŠå‚æ•°iä½œä¸ºfuncçš„å‚æ•°ä¼ å…¥ï¼Œè¦ä¸ç„¶iä¼šä½¿ç”¨æœ€åä¸€æ¬¡å¾ªç¯çš„é‚£ä¸ªå€¼ï¼š</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#6272a4">// é”™è¯¯ä»£ç ğŸ‘‡
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">:=</span> <span style="color:#bd93f9">0</span>; i &lt; <span style="color:#bd93f9">10</span>; i<span style="color:#ff79c6">++</span> {
    <span style="color:#ff79c6">go</span> <span style="color:#8be9fd;font-style:italic">func</span>() {
        <span style="color:#ff79c6">defer</span> wg.<span style="color:#50fa7b">Done</span>()
        <span style="color:#50fa7b">parseUrls</span>(<span style="color:#f1fa8c">&#34;https://movie.douban.com/top250?start=&#34;</span><span style="color:#ff79c6">+</span>strconv.<span style="color:#50fa7b">Itoa</span>(<span style="color:#bd93f9">25</span><span style="color:#ff79c6">*</span>i))
    }()
}
â¯ <span style="color:#ff79c6">go</span> run crawler<span style="color:#ff79c6">/</span>doubanCrawler5.<span style="color:#ff79c6">go</span>
Fetch Url https:<span style="color:#6272a4">//movie.douban.com/top250?start=75
</span><span style="color:#6272a4"></span>Fetch Url https:<span style="color:#6272a4">//movie.douban.com/top250?start=250
</span><span style="color:#6272a4"></span>Fetch Url https:<span style="color:#6272a4">//movie.douban.com/top250?start=250
</span><span style="color:#6272a4"></span>Fetch Url https:<span style="color:#6272a4">//movie.douban.com/top250?start=250
</span><span style="color:#6272a4"></span>Fetch Url https:<span style="color:#6272a4">//movie.douban.com/top250?start=250
</span><span style="color:#6272a4"></span>Fetch Url https:<span style="color:#6272a4">//movie.douban.com/top250?start=250
</span><span style="color:#6272a4"></span>Fetch Url https:<span style="color:#6272a4">//movie.douban.com/top250?start=250
</span><span style="color:#6272a4"></span>Fetch Url https:<span style="color:#6272a4">//movie.douban.com/top250?start=250
</span><span style="color:#6272a4"></span>Fetch Url https:<span style="color:#6272a4">//movie.douban.com/top250?start=250
</span><span style="color:#6272a4"></span>Fetch Url https:<span style="color:#6272a4">//movie.douban.com/top250?start=200
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">...</span></code></pre></div>

<p>å’¦ï¼Œçœ‹ä»£ç ï¼Œiåœ¨ç­‰äº9çš„æ—¶å€™å¾ªç¯ç»“æŸï¼Œstartåº”è¯¥æ˜¯225(9 *  25)ï¼Œä½†ä¸ºä»€ä¹ˆ250å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨æœ€åè¿˜æœ‰ä¸ª<code>i++</code>ï¼Œè™½ç„¶ä¸ç¬¦åˆæ¡ä»¶æ²¡æœ‰è¿›è¡Œå¾ªç¯ï¼Œä½†æ˜¯içš„å€¼ç¡®å®å‘ç”Ÿäº†æ”¹å˜ï¼</p>

<p>åœ¨è¿™æ ·çš„ç”¨æ³•ä¸­ï¼ŒWaitGroupç›¸å½“äºæ˜¯ä¸€ä¸ªåç¨‹å®‰å…¨çš„å¹¶å‘è®¡æ•°å™¨ï¼šè°ƒç”¨Addå¢åŠ è®¡æ•°ï¼Œè°ƒç”¨Doneå‡å°‘è®¡æ•°ã€‚è°ƒç”¨Waitä¼šé˜»å¡å¹¶ç­‰å¾…è‡³è®¡æ•°å™¨å½’é›¶ã€‚è¿™æ ·ä¹Ÿå®ç°äº†å¹¶å‘å’Œç­‰å¾…å…¨éƒ¨goroutineæ‰§è¡Œå®Œæˆï¼š</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">â¯ go run doubanCrawler5.go
...
Took <span style="color:#bd93f9">2</span>.382876529s  <span style="color:#6272a4"># è¿™ä¸ªæ—¶é—´å’Œä¹‹å‰çš„ä¿¡é“ç”¨æ³•æ•ˆæœä¸€è‡´ï¼</span></code></pre></div>

<h3 id="åè®°">åè®°</h3>

<p>å¥½å•¦ï¼Œè¿™ç¯‡æ–‡ç« å…ˆå†™åˆ°è¿™é‡Œå•¦~</p>

<h3 id="ä»£ç åœ°å€">ä»£ç åœ°å€</h3>

<p>å®Œæ•´ä»£ç éƒ½å¯ä»¥åœ¨<a href="https://github.com/golang-dev/strconv.code/blob/master/crawler">è¿™ä¸ªåœ°å€</a>æ‰¾åˆ°ã€‚</p>

      </div>

      <footer>
        


        
        <div id="commento"></div>
<script src="https://strconv.com/js/commento.js"></script>
      </footer>
    </article>

    
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    
      <p>æˆ‘æ˜¯ä¸€ä¸ªGolangæ¨¡å—.</p>
    
     Â© 2019
    
       Â· 
      Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
    
    
  </section>
</footer>

    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-143191829-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


  </body>

</html>
